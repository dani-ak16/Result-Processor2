<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Result Sheet - {{ student.full_name }}</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      @page {
        size: A4;
        margin: 8mm;
      }

      body {
        font-family: "Montserrat", sans-serif;
        font-size: 9.5px;
        line-height: 1.35;
        color: #2c3e50;
        background: #fff;
      }

      .container {
        width: 100%;
        max-width: 190mm;
        margin: 0 auto;
        background: #fff;
        padding: 8mm;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
      }

      /* Header */
      .header {
        display: flex;
        justify-content: space-between;
        background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
        color: white;
        padding: 10px;
        text-align: left;
        border-radius: 6px 6px 0 0;
        margin: -8mm -8mm 10px;
        position: relative;
      }

      .logo-section {
        display: flex;
        align-items: center;
        justify-content: flex-start;
        gap: 10px;
        font-size: 9px;
      }

      .school-logo {
        width: 45px;
        height: 45px;
        border-radius: 50%;
        border: 2px solid white;
        object-fit: cover;
      }

      .school-info h1 {
        font-size: 16px;
        font-weight: 700;
        margin: 0;
      }

      .school-info p {
        font-size: 8px;
        margin: 1px 0;
        opacity: 0.9;
      }

      .report-title {
        font-size: 14px;
        font-weight: 600;
        margin: 4px 0 2px;
        letter-spacing: 1px;
      }

      .academic-info {
        display: flex;
        justify-content: flex-start;
        gap: 20px;
        font-size: 9px;
        font-weight: 500;
      }

      /* Student Info */
      .student-section {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 8px;
        gap: 10px;
      }

      .student-details h2 {
        font-size: 13px;
        color: #1e3c72;
        margin-bottom: 4px;
        text-transform: uppercase;
      }

      .detail-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 4px 12px;
        font-size: 9px;
      }

      .detail-item {
        display: flex;
        justify-content: space-between;
        border-bottom: 1px dashed #ddd;
        padding: 2px 0;
      }

      .detail-label {
        font-weight: 600;
        color: #1e3c72;
      }

      .student-photo {
        width: 75px;
        height: 75px;
        border: 2px solid #1e3c72;
        border-radius: 6px;
        object-fit: fill;
        flex-shrink: 0;
      }

      /* Results Table */
      .section-title {
        font-size: 11px;
        font-weight: 600;
        color: #1e3c72;
        margin: 10px 0 6px;
        padding-bottom: 3px;
        border-bottom: 1.5px solid #1e3c72;
      }

      .results-table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 8px;
        font-size: 8.5px;
      }

      .results-table th {
        background: #1e3c72;
        color: white;
        padding: 6px 5px;
        font-weight: 500;
        font-size: 8px;
        text-align: center;
      }

      .results-table td {
        padding: 5px;
        text-align: center;
        border-bottom: 1px solid #eee;
      }

      .results-table tr:nth-child(even) {
        background: #f8f9fa;
      }

      .grade-A {
        color: #28a745;
        font-weight: 600;
      }
      .grade-B {
        color: #17a2b8;
        font-weight: 600;
      }
      .grade-C {
        color: #ffc107;
        font-weight: 600;
      }
      .grade-D {
        color: #fd7e14;
        font-weight: 600;
      }
      .grade-F {
        color: #dc3545;
        font-weight: 600;
      }

      /* Summary Cards */
      .summary-grid {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 6px;
        margin: 8px 0;
      }

      .summary-card {
        background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
        color: white;
        padding: 6px;
        border-radius: 6px;
        text-align: center;
        font-size: 8px;
      }

      .summary-value {
        font-size: 13px;
        font-weight: 700;
        margin: 2px 0;
      }

      /* Assessment */
      .assessment-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
        margin: 8px 0;
        font-size: 8.5px;
      }

      .assessment-table {
        width: 100%;
        border-collapse: collapse;
      }

      .assessment-table th {
        background: #495057;
        color: white;
        padding: 4px 6px;
        font-size: 8px;
        text-align: left;
      }

      .assessment-table td {
        padding: 4px 6px;
        border-bottom: 1px solid #eee;
      }

      .rating {
        display: flex;
        gap: 3px;
      }

      .rating-dot {
        width: 9px;
        height: 9px;
        border-radius: 50%;
        background: #ddd;
      }

      .rating-dot.filled {
        background: #ffc107;
      }

      /* Attendance */
      .attendance-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 6px;
        margin: 8px 0;
        font-size: 8px;
      }

      .attend-item {
        background: #f8f9fa;
        padding: 5px;
        border-radius: 5px;
        text-align: center;
        border: 1px solid #e9ecef;
      }

      .attend-value {
        font-size: 14px;
        font-weight: 700;
        color: #1e3c72;
      }

      /* Comments & Footer */
      .comments-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 8px;
        margin: 8px 0;
        font-size: 8.5px;
      }

      .comment-box {
        background: #f8f9fa;
        padding: 6px;
        border-left: 3px solid #1e3c72;
        border-radius: 0 4px 4px 0;
      }

      .comment-title {
        font-weight: 600;
        color: #1e3c72;
        margin-bottom: 3px;
        font-size: 9px;
      }

      .comment-text {
        min-height: 36px;
        color: #555;
        font-size: 8px;
      }

      .signature-grid {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr;
        gap: 8px;
        margin-top: 8px;
        font-size: 8px;
        text-align: center;
      }

      .signature-line {
        width: 60px;
        height: 1px;
        background: #333;
        margin: 12px auto 3px;
      }

      .stamp-box {
        width: 60px;
        height: 50px;
        border: 2px dashed #999;
        margin: 8px auto;
      }

      .dates-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 8px;
        margin-top: 8px;
        font-size: 8.5px;
      }

      .date-item {
        background: #f0f4f8;
        padding: 5px;
        border-radius: 4px;
        text-align: center;
      }

      @media print {
        body,
        .container {
          margin: 0;
          padding: 5mm;
          box-shadow: none;
          border: none;
        }
        .header {
          margin: -5mm -5mm 8px;
          border-radius: 0;
        }
        @page {
          margin: 5mm;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- Header -->
      <div class="header">
        <div class="logo-section">
          <img
            src="{{ url_for('static', filename='kembos_logo_nobg.png') }}"
            class="school-logo"
            alt="Logo"
          />
          <div class="school-info">
            <h1>KEMBOS COLLEGE</h1>
            <p>
              23-25, Nusirat Lasisi Street, Off James Oni Street, Isolo, Lagos
              State
            </p>
            <p>kembosgroup@gmail.com | +2348065237466, +2349030012421</p>
          </div>
        </div>
        <div>
          <div class="report-title">FIRST TERM REPORT SHEET</div>
          <div class="academic-info">
            <span>Session: {{ session }}</span>
            <span>Term: {{ term }}</span>
          </div>
        </div>
      </div>

      <!-- Student Info -->
      <div class="student-section">
        <div class="student-details">
          <h2 style="">{{ student.full_name }}</h2>
          <div class="detail-grid">
            <div class="detail-item">
              <span class="detail-label">Class: </span>
              <span>{{ class_name }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Department:</span>
              <span>
                {% if student.department_id == 1 %}Science {% elif
                student.department_id == 2 %}Arts/Humanities {% elif
                student.department_id == 3 %}Commercial {% else %}General{%
                endif %}
              </span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Age:</span>
              <span>{{ student.age or "N/A" }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Gender:</span>
              <span>{{ student.gender or "N/A" }}</span>
            </div>
          </div>
        </div>

        <div class="attendance-grid">
          <div class="attend-item">
            <div>Total Days</div>
            <div class="attend-value">
              {{ attendance_summary.total_school_days or 0 }}
            </div>
          </div>
          <div class="attend-item">
            <div>Present</div>
            <div class="attend-value">
              {{ attendance_summary.days_present or 0 }}
            </div>
          </div>
          <div class="attend-item">
            <div>Absent</div>
            <div class="attend-value">
              {{ attendance_summary.days_absent or 0 }}
            </div>
          </div>
          <div class="attend-item">
            <div>Rate</div>
            <div class="attend-value">
              {% if attendance_summary.total_school_days and
              attendance_summary.total_school_days > 0 %} {{
              "%.1f"|format((attendance_summary.days_present or 0) /
              attendance_summary.total_school_days * 100) }}% {% else %}0%{%
              endif %}
            </div>
          </div>
        </div>

        {% if student.photo %}
        <img
          src="{{ url_for('serve_uploaded_photo', filename=student.photo) }}"
          class="student-photo"
          alt="Photo"
        />
        {% endif %}
      </div>

      <!-- Academic Results -->
      <h3 class="section-title">ACADEMIC PERFORMANCE</h3>
      <table class="results-table">
        <thead>
          <tr>
            <th>Subject</th>
            <th>CA1</th>
            <th>CA2</th>
            <th>CA3</th>
            <th>CA4</th>
            <th>CA Total</th>
            <th>Exam</th>
            <th>Grand Total</th>
            <th>Grade</th>
            <th>Remark</th>
          </tr>
        </thead>
        <tbody>
          {% for row in scores %} {% set grade_class = 'grade-A' if
          row.total_score >= 75 else 'grade-B' if row.total_score >= 65 else
          'grade-C' if row.total_score >= 55 else 'grade-D' if row.total_score
          >= 40 else 'grade-F' %}
          <tr>
            <td style="text-align: left; font-weight: 700">
              {{ row.subject }}
            </td>
            <td>{{row.ca1_score}}</td>
            <td>{{row.ca2_score}}</td>
            <td>{{row.ca3_score}}</td>
            <td>{{row.ca4_score}}</td>
            <td>
              {{ row.ca1_score + row.ca2_score + row.ca3_score + row.ca4_score
              }}
            </td>
            <td>{{row.exam_score}}</td>
            <td>{{ "%.1f"|format(row.total_score) }}</td>
            <td class="{{ grade_class }}">
              {% if row.total_score >= 75 %}A1{% elif row.total_score >= 70
              %}B2{% elif row.total_score >= 65 %}B3{% elif row.total_score >=
              60 %}C4{% elif row.total_score >= 55 %}C5{% elif row.total_score
              >= 50 %}C6{% elif row.total_score >= 45 %}D7{% elif
              row.total_score >= 40 %}E8{% else %}F9{% endif %}
            </td>
            <td>
              {% if row.total_score >= 80 %}Excellent{% elif row.total_score >=
              70 %}Very Good{% elif row.total_score >= 60 %}Good{% elif
              row.total_score >= 50 %}Pass{% else %}Fail{% endif %}
            </td>
            <!-- <td>{{ loop.index }}/{{ scores|length }}</td> -->
          </tr>
          {% endfor %}
        </tbody>
      </table>

      <div class="summary-grid">
        <div class="summary-card">
          <div class="summary-value">{{ "%.1f"|format(average) }}%</div>
          <div>Average</div>
        </div>
        <div class="summary-card">
          <div class="summary-value">{{ scores|length }}</div>
          <div>Subjects</div>
        </div>
        <div class="summary-card">
          <div class="summary-value">
            {{ scores|sum(attribute='total_score') }}/{{ 100 * scores|length}}
          </div>
          <div>Total</div>
        </div>
        <div class="summary-card">
          <div class="summary-value">
            {% set passed = scores|selectattr('total_score', '>=',
            50)|list|length %} {{ passed }}/{{ scores|length }}
          </div>
          <div>Passed</div>
        </div>
      </div>

      <!-- Development Assessment -->
      <h3 class="section-title">DEVELOPMENT ASSESSMENT</h3>
      <div class="assessment-grid">
        <div>
          <strong style="font-size: 8.5px; color: #495057"
            >Psychomotor Skills</strong
          >
          <table class="assessment-table">
            <tr>
              <th>Skill</th>
              <th>Rating</th>
            </tr>
            <tr>
              <td>Handwriting</td>
              <td>
                <div class="rating">
                  {% for i in range(5) %}
                  <div
                    class="rating-dot {% if assessment.handwriting and i < assessment.handwriting %}filled{% endif %}"
                  ></div>
                  {% endfor %}
                </div>
              </td>
            </tr>
            <tr>
              <td>Sports</td>
              <td>
                <div class="rating">
                  {% for i in range(5) %}
                  <div
                    class="rating-dot {% if assessment.sports_participation and i < assessment.sports_participation %}filled{% endif %}"
                  ></div>
                  {% endfor %}
                </div>
              </td>
            </tr>
            <tr>
              <td>Practical</td>
              <td>
                <div class="rating">
                  {% for i in range(5) %}
                  <div
                    class="rating-dot {% if assessment.practical_skills and i < assessment.practical_skills %}filled{% endif %}"
                  ></div>
                  {% endfor %}
                </div>
              </td>
            </tr>
          </table>
        </div>
        <div>
          <strong style="font-size: 8.5px; color: #495057"
            >Affective Domain</strong
          >
          <table class="assessment-table">
            <tr>
              <th>Trait</th>
              <th>Rating</th>
            </tr>
            <tr>
              <td>Punctuality</td>
              <td>
                <div class="rating">
                  {% for i in range(5) %}
                  <div
                    class="rating-dot {% if assessment.punctuality and i < assessment.punctuality %}filled{% endif %}"
                  ></div>
                  {% endfor %}
                </div>
              </td>
            </tr>
            <tr>
              <td>Politeness</td>
              <td>
                <div class="rating">
                  {% for i in range(5) %}
                  <div
                    class="rating-dot {% if assessment.politeness and i < assessment.politeness %}filled{% endif %}"
                  ></div>
                  {% endfor %}
                </div>
              </td>
            </tr>
            <tr>
              <td>Neatness</td>
              <td>
                <div class="rating">
                  {% for i in range(5) %}
                  <div
                    class="rating-dot {% if assessment.neatness and i < assessment.neatness %}filled{% endif %}"
                  ></div>
                  {% endfor %}
                </div>
              </td>
            </tr>
          </table>
        </div>
      </div>

      <!-- <div class="attendance-grid">
        <div class="attend-item">
          <div>Total Days</div>
          <div class="attend-value">
            {{ attendance_summary.total_school_days or 0 }}
          </div>
        </div>
        <div class="attend-item">
          <div>Present</div>
          <div class="attend-value">
            {{ attendance_summary.days_present or 0 }}
          </div>
        </div>
        <div class="attend-item">
          <div>Absent</div>
          <div class="attend-value">
            {{ attendance_summary.days_absent or 0 }}
          </div>
        </div>
        <div class="attend-item">
          <div>Rate</div>
          <div class="attend-value">
            {% if attendance_summary.total_school_days and
            attendance_summary.total_school_days > 0 %} {{
            "%.1f"|format((attendance_summary.days_present or 0) /
            attendance_summary.total_school_days * 100) }}% {% else %}0%{% endif
            %}
          </div>
        </div>
      </div> -->

      <!-- Comments & Signatures -->
      <div class="comments-grid">
        <div class="comment-box">
          <div class="comment-title">Class Teacher</div>
          <div class="comment-text">
            {{ assessment.class_teacher_comment or "No comment available."}}
          </div>
        </div>
        <div class="comment-box">
          <div class="comment-title">Principal</div>
          <div class="comment-text">
            {{ assessment.principal_comment or "No comment available."}}
          </div>
        </div>
      </div>

      <div class="signature-grid">
        <div>
          <div>Teacher's Signature</div>
          <div class="signature-line"></div>
          <div>Date: ________</div>
        </div>
        <div>
          <div>Principal's Signature</div>
          <div class="signature-line"></div>
          <div>Date: ________</div>
        </div>
        <div>
          <div>School Stamp</div>
          <div class="stamp-box"></div>
        </div>
      </div>

      <div class="dates-grid">
        <div class="date-item">
          <div>Term Ends</div>
          <div>15th Dec, {{ year }}</div>
        </div>
        <div class="date-item">
          <div>Next Term</div>
          <div>8th Jan, {{ year|int + 1 }}</div>
        </div>
      </div>
    </div>
  </body>
</html>
